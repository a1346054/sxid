# sxid - suid, sgid file and directory checking
#
# Copyright (C) 1999, 2000, 2002 Ben Collins <bcollins@debian.org>
#
# This is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2,
# or (at your option) any later version.
#
# This is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public
# License along with sxid; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
# 02110-1301 USA.

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
sysconfdir = @sysconfdir@
mandir = @mandir@

CC=@CC@
LD=$(CC)

CFLAGS=@CFLAGS@ -I.
INSTALL=@INSTALL@
INSTALL_DATA=$(INSTALL) -m 644
INSTALL_PROGRAM=$(INSTALL) -m 755
INSTALL_DIR=$(INSTALL) -d -m 755
LDFLAGS=@LDFLAGS@
LIBS=@LIBS@

TARGET=sxid

EXTRA_OBJ = @EXTRA_OBJ@

OBJS=	sxid.o \
	md5.o \
	md5sum.o \
	logging.o \
	notify.o \
	conffile.o \
	search.o

all: $(TARGET)

$(TARGET): $(OBJS) $(EXTRA_OBJ)
	$(LD) $(LDFLAGS) $(LIBS) $(OBJS) $(EXTRA_OBJ) -o $(TARGET)

install: $(TARGET) ../docs/sxid.1 ../docs/sxid.conf.example
	$(INSTALL_DIR) $(DESTDIR)$(sysconfdir)
	$(INSTALL_DIR) $(DESTDIR)$(mandir)/man1
	$(INSTALL_DIR) $(DESTDIR)$(mandir)/man5
	$(INSTALL_DIR) $(DESTDIR)$(bindir)
	if ! test -e $(DESTDIR)$(sysconfdir)/sxid.conf; then \
		$(INSTALL_DATA) ../docs/sxid.conf.example \
		$(DESTDIR)$(sysconfdir)/sxid.conf; \
	fi
	$(INSTALL_DATA) ../docs/sxid.1 $(DESTDIR)$(mandir)/man1/sxid.1
	$(INSTALL_DATA) ../docs/sxid.conf.5 $(DESTDIR)$(mandir)/man5/sxid.conf.5
	$(INSTALL_PROGRAM) $(TARGET) $(DESTDIR)$(bindir)/$(TARGET)
	@echo
	@echo You now need to add a cron entry \(see: docs/sxid.cron.example\)
	@echo

clean:
	rm -f $(OBJS) $(EXTRA_OBJ) $(TARGET) core

.c.o:
	$(CC) $(CFLAGS) -c $< -o $*.o
